<!doctype html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- SOCIAL MEDIA META -->
    <meta property="og:description" content="Fieldsight">
    <meta property="og:image" content="preview.html">
    <meta property="og:site_name" content="Fieldsight">
    <meta property="og:title" content="Fieldsight">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://naxa.com.np">

    <!-- TWITTER META -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@Fieldsight">
    <meta name="twitter:creator" content="@Fieldsight">
    <meta name="twitter:title" content="Fieldsight">
    <meta name="twitter:description" content="Fieldsight">
    <meta name="twitter:image" content="preview.html">

    <!--title-->
    <title>Fieldsight</title>

    <!-- faveicon start   -->
    <link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32">

    <!-- stylesheet start -->
    <link rel="stylesheet" type="text/css" href="http://fieldsight.naxa.com.np/static/v2/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="http://fieldsight.naxa.com.np/static/v2/css/line-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="http://fieldsight.naxa.com.np/static/v2/css/nice-select.css">
    <link rel="stylesheet" type="text/css" href="http://fieldsight.naxa.com.np/static/v2/js/datatable/dataTables.bs4.css">
    <link rel="stylesheet" type="text/css" href="http://fieldsight.naxa.com.np/static/v2/css/main.css">
</head>

<body class="">
    <!-- <div id="site_info"></div> -->
    <div id="fieldsight-new" class="fieldsight-new">
        <div id="main-container" class="minified">
            <div class="container-fluid">
                <nav aria-label="breadcrumb" role="navigation">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/fieldsight/organization/">Teams</a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/fieldsight/organization-dashboard/13/">Build Change</a>
                        </li>

                        <li class="breadcrumb-item active" aria-current="page">DFID 31 District Retrofitting</li>
                    </ol>
                </nav>
                <main id="main-content">
                    <div class="row">
                        <div class="col-xl-3 col-lg-4">
                            <div class="left-sidebar sidebar sticky-top">
                                <div class="card">
                                    <div class="card-header main-card-header">
                                        <h5>Meta Attributes</h5>
                                    </div>
                                    <div class="card-body">
                                        <ul class="nav nav-tabs flex-column" id="myTab" role="tablist">
                                            <li class="nav-item">
                                                <a class="nav-link" id="site_type_tab" data-toggle="tab" href="#site_type" role="tab" aria-controls="site_type" aria-selected="false">Site types</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link active" id="site_info_tab" data-toggle="tab" href="#site_info" role="tab" aria-controls="site_info" aria-selected="true">site information</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="site_manage_tab" data-toggle="tab" href="#site_manage" role="tab" aria-controls="site_manage" aria-selected="false">manage sites</a>
                                            </li>
                                            <li class="nav-item">
                                                <a class="nav-link" id="map_layer_tab" data-toggle="tab" href="#map_layer" role="tab" aria-controls="map_layer" aria-selected="false">manage sites</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="col-xl-9 col-lg-8">
                            <div class="right-content">
                                <div class="tab-content" id="myTabContent">
                                    <div class="tab-pane fade" id="site_type" role="tabpanel" aria-labelledby="site_type_tab">
                                        <div class="card">
                                            <div class="card-header main-card-header">
                                                <h5>Site Type</h5>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade show active" id="site_info" role="tabpanel" aria-labelledby="site_info_tab">
                                    </div>
                                    <form id="theForm" action="" method="post">

                                        <input name="json_questions" id="json_questions" type="hidden" value="" />
                                        <input name="site_basic_info" id="site_basic_info" type="hidden" value="" />
                                        <input name="site_featured_images" id="site_featured_images" type="hidden" value="" />
                                    </form>

                                    <div class="tab-pane fade" id="site_manage" role="tabpanel" aria-labelledby="site_manage_tab">
                                        <div class="card">
                                            <div class="card-header main-card-header">
                                                <h5>Site Mangage</h5>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="map_layer" role="tabpanel" aria-labelledby="map_layer_tab">
                                        <div class="card">
                                            <div class="card-header main-card-header">
                                                <h5>Map layer</h5>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- jquery library start -->
    <script src="http://fieldsight.naxa.com.np/static/v2/js/vendor/jquery-3.4.1.min.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/v2/js/vendor/popper.min.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/v2/js/vendor/bootstrap.min.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/v2/js/vendor/jquery.nice-select.min.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/v2/js/vendor/jquery.slimscroll.min.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/v2/js/script.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/js/formparser.js?v=1.1"></script>
    <script src="http://fieldsight.naxa.com.np/static/js/reactjs/react.min.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/js/reactjs/browser.min.js"></script>
    <script src="http://fieldsight.naxa.com.np/static/js/reactjs/react-dom.min.js"></script>


    <script type="text/babel">
    var site_info;
     var _json_question = JSON.parse("[]");
     var project_id = "323";
     var org_id = "142";
     var site_basic_info = JSON.parse("{}");
     var site_featured_images = JSON.parse("[]");
     var questionTypes = [{'id': 'Text', 'name': 'Text'}, 
                          {'id': 'Number', 'name': 'Number'},
                          {'id': 'Date', 'name': 'Date'},
                          {'id': 'MCQ', 'name': 'Select one'},
                          {'id': 'Link', 'name': 'Draw from another project'},
                          {'id': 'Form', 'name': 'Draw answer from a form'},
                          {'id': 'FormSubStat', 'name': 'Form submission'},
                          {'id': 'FormSubCountQuestion', 'name':'Form submissions count'},
                          {'id': 'FormQuestionAnswerStatus', 'name':'Form question answer status'} ];
     
    var sitePictureTypes = [
        {'id': 'upload', 'name': 'Upload'}, 
        {'id': 'Form', 'name': 'Choose from a form'},
        {'id': 'choose', 'name': 'Choose from Gallery'},
    ]
    var siteFeaturedTypes = [
        {'id': 'Form', 'name': 'Choose from a form'},
        {'id': 'choose', 'name': 'Choose from Gallery'},
    ]
    var siteLocationTypes = [
        {'id': 'choose', 'name': 'Enter a location / Choose on map'}, 
        {'id': 'Form', 'name': 'Choose from a form'},
    ]

   
    var SelectComponent = React.createClass({
            
            getInitialState: function () {
                return {}
            },
   
            renderNormal:function(){
                return(
                        <select ref={this.props.inputRef} className="form-control" name="project" onChange={this.props.onChangeFunction} value={this.props.defaultValue}>
                            {this.props.options.map((e, key) => {
                                return <option key={key} value={this.props.isProject ? key : e.id}>{e.name}</option>;
                            })}
                        </select>
                    );
            },
            render: function () {
                    return this.renderNormal();
            }
        });
    var FormSelectComponent = React.createClass({
            
            getInitialState: function () {
                return {}
            },
   
            renderNormal:function(){
                return(
                    <select ref={this.props.inputRef} className="form-control" name="project" onChange={this.props.onChangeFunction} value={this.props.defaultValue}>
                        {Object.keys(this.props.questions).map((e, key) => {
                            return <option key={key} value={e}>{this.props.questions[e].label}</option>;
                        })}
                    </select>          
                    );
            },
            render: function () {
                    return this.renderNormal();
            }
        });
    var CheckboxComponent = React.createClass({
            
            
            getInitialState: function () {
                return {isloaded:false, metas:[], project_id:0, selected_metas:[], indent:0}
            },
            loadmetas: function(metas, project_id, selected_metas, indent){
                this.setState({'metas':metas, 'project_id':project_id, 'selected_metas':selected_metas, 'indent':indent}) 
            },
            componentDidMount(){
                this.loadmetas(this.props.metas, this.props.project_id, this.props.selected_metas, this.props.indent || 0);
            },
            componentWillReceiveProps(nextProps) {
                this.loadmetas(nextProps.metas, nextProps.project_id, nextProps.selected_metas, this.props.indent || 0);
            },
            
            toggleCheckbox:function(index, obj) {
                this.props.updateSelectedMetas(this.state.project_id, obj);
            },
            eachMeta: function (obj, j){            
               
                const style={
                            'margin-left': this.props.indent+'px',
                        }
                if(obj.question_type=='Link'){
                    if (obj.project_id.toString() != project_id.toString()){
                    
                    const submetas = [];
                    if((this.state.selected_metas[this.state.project_id] || []).find(temp=>temp.question_name == obj.question_name)){
                    submetas.push(
                         <CheckboxComponent project_id={obj.project_id} metas={obj.metas[obj.project_id]} selected_metas={this.state.selected_metas} indent={this.state.indent + 20} updateSelectedMetas={this.props.updateSelectedMetas}/>
                        )
                    }
                    return (
                        <div>
                        <br/>
                        <div style={style}>
                            <label>
                                <input
                                    type="checkbox"
                                    checked={(this.state.selected_metas[this.state.project_id] || []).find(temp=>temp.question_name == obj.question_name)}
                                    onChange={this.toggleCheckbox.bind(this, j, obj)}
                                />
                                <b>
                                {obj.question_text}
                                </b>
                                </label>
                        </div>
                        {
                            submetas
                        }</div>
                        )
                    }
                }
                else{
                return(
                <div style={style}>
                    <label>
                        <input
                            type="checkbox"
                            checked={(this.state.selected_metas[this.state.project_id] || []).find(temp=>temp.question_name == obj.question_name)}
                            onChange={this.toggleCheckbox.bind(this, j, obj)}
                        />
                        {obj.question_text}
                        </label>
                </div>)
                }
            },
                          
            renderNormal:function(){
                
                return (<div>
                    {         
                        this.state.metas.map(this.eachMeta)
                    }
                </div>
            );
            },
            render: function () {
                    return this.renderNormal();
            }
        });
     var NormalQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:questionTypes, editing:this.props.editing | this.props.is_new}
            },
            save: function () {
                this.props.updateQuestionText(this.refs.newText.value, this.refs.questionType.value, this.refs.placeholder.value, this.refs.helpText.value, this.props.index);
                 console.log('save', this.refs.helpText.value);
            },
            
            remove:function(){
                // console.log('Delete pressed.')
                this.props.deleteFromForm(this.props.index);
            },
            edit: function () {
                this.props.edit(this.props.index)
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                    
                }
                this.props.editDone(this.props.index)
                
            },
            renderNormal:function(){
                return(
                    <tr>
                        <td>{this.props.index + 1}</td>
                        <td>{this.props.question}</td>
                        <td>{this.props.question_type}</td>
                        <td>{ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}</td>
                        <td>{ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""}</td>
                        <td></td>
                        <td></td>
                        
                        <td>
                            <a href="#" className="td-edit-btn" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"> <i className="la la-edit"> </i> </a>
                            <a href="#" className="td-delete-btn" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"> <i className="la la-trash-o"></i> </a>
                        </td>
                    </tr>    
                );
            },
            renderForm:function(){
                return(
                        <div className="form-field-item margin-top">
                            <div className="form-group">
                                <label for="input1" className="col-form-label">Input Label:</label>
                                <input type="text" ref="newText" className="form-control" onChange={this.save} placeholderText="Attribute Label" defaultValue={this.props.question}></input>
                                <small className="form-text text-muted">Text in this field will appear as a label for your form field.</small>
                            </div>
                            <div className="form-group">
                                <label className="col-form-label">Input Type:</label>
                                    <SelectComponent inputRef={el => this.refs.questionType = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                                <small id="input1Help" className="form-text text-muted">Type of input you want.</small>
                            </div>
                            <div className="form-group">
                                <label className="col-form-label">Placeholder:</label>
                                <input type="text" ref="placeholder" className="form-control" onChange={this.save} placeholderText="Placeholder" defaultValue={ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}></input>
                                <small className="form-text text-muted">Description for this field</small>
                            </div>
                            <div className="form-group">
                                <label className="col-form-label">Help Text:</label>
                                <textarea ref="helpText" className="form-control" value={ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""} onChange={this.save}/>
                                <small id="input1Help" className="form-text text-muted">Description for this field</small>
                            </div>
                            <button type="submit" className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button>
                        </div>
                    
                );
            },
            render: function () {
                    if(this.state.editing){
                        return this.renderForm();
                    }
                    else{
                        return this.renderNormal();   
                    }
            }
        });
     var Option = React.createClass({
            
            getInitialState: function () {
                return {editing: true}
            },
            
            edit:function(){
               this.setState({editing: true});
            },
            save: function () {
                this.props.updateOption(this.refs.newOptionText.value, this.props.index);
                // console.log('save');
            },
            
            remove:function(){
                // console.log('Delete pressed.' + this.props.index)
                this.props.deleteOption(this.props.index);
            },            
   
            renderNormal:function(){
                return(
                    <div className="QuestionContainer form-row">
                        <div className="form-group col-md-9">
                            <label for="input1" className="col-form-label">Option {this.props.index + 1}:</label>
                            <input type="text" ref="newOptionText" className="form-control" onChange={this.save} defaultValue={this.props.option_text} placeholder= "Option Text"></input>
                        </div>
                        <div className="form-group col-md-3">
                            <label className="col-form-label"> &nbsp; </label>                     
                            <button className="btn btn-danger" type="button" id="removebutton" onClick={this.remove}><i className="la la-close"></i>Remove</button>
                        </div>
                    </div>
                );
            },
            render: function () {
                return this.renderNormal();
            }
        });
      var MCQQuestion = React.createClass({
            getInitialState: function () {
                return {questionTypes:questionTypes, options:this.props.options, editing:this.props.editing | this.props.is_new}
            },
            
            addOption:function () {
                var arr =this.state.options;
                var new_option={"option_text":""};
                arr.push(new_option);
                this.setState({options: arr});
            },
            save: function () {
                this.props.updateMCQOptions(this.state.options, this.props.index);
                this.props.updateQuestionText(this.refs.newText.value, this.refs.questionType.value, "", this.refs.helpText.value, this.props.index);
            },
            updateOption: function(newTextoption, i){
                var arr= this.state.options;
                arr[i].option_text = newTextoption;
                this.setState({options: arr});
                this.props.updateMCQOptions(this.state.options, this.props.index);
            },
            deleteOption: function(i){
                var arr= this.state.options;
                arr[i].is_deleted=true;
                this.setState({options:arr})               
                this.props.updateMCQOptions(this.state.options, this.props.index);
            },
            remove:function(){
                //console.log('Delete pressed.')
                this.props.deleteFromForm(this.props.index);
            },
            
            edit: function () {
                this.props.edit(this.props.index)
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                    
                }
                this.props.editDone(this.props.index)
            },
            eachOption: function (obj, j){
                // console.log(text);
                if(!obj.hasOwnProperty('is_deleted')){
                return(
                    <Option key={j} index={j} option_text={obj.option_text} deleteOption={this.deleteOption} updateOption={this.updateOption}/>
                    );
                 }},
            renderNormal:function(){
                var optionslist = [{'option_text' :false}].concat(this.props.options);
                var options = optionslist.map(function(item) {
                  
                      if(item.option_text === false){
                          return <option value={""}> 
                              Please select and option
                             </option>;
                          }        
                    return <option value = {
                      item.option_text
                    } > {
                      item.option_text
                    } </option>;
                  
                })
                return(
                    <tr>
                        <td>{this.props.index + 1}</td>
                        <td>{this.props.question}</td>
                        <td>{this.props.question_type}</td>
                        <td>{ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}</td>
                        <td>{ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""}</td>
                        <td></td>
                        <td></td>
                        
                        <td>
                            <a href="#" className="td-edit-btn" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"> <i className="la la-edit"> </i> </a>
                            <a href="#" className="td-delete-btn" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"> <i className="la la-trash-o"></i> </a>
                        </td>
                    </tr>  
                );
            },
            renderForm:function(){
                return(
                     <div className="form-field-item margin-top">
                        <div className="form-group">
                                <label for="input1" className="col-form-label">Input Label:</label>
                                <input type="text" ref="newText" className="form-control" onChange={this.save} placeholder="Attribute Label" defaultValue={this.props.question}></input>
                            </div>
                            <div className="form-group">
                                <label for="input2" fetchclassName="col-form-label">Input Type:</label>
                                <SelectComponent inputRef={el => this.refs.questionType = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                            </div>
                            <div className="form-group">
                                <label className="col-form-label">Help Text:</label>
                                <textarea ref="helpText" className="form-control" value={ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""} onChange={this.save}/>
                                <small id="input1Help" className="form-text text-muted">Description for this field</small>
                            </div>
                        {         
                            this.state.options.map(this.eachOption)
                        }
                    <button onClick={this.addOption} className="btn btn-primary"><i className="la la-plus"></i> Option</button><hr/>
                    <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add Attribute':'Preview'}</button>            
                    </div>
                );
            },
            render: function () {
                if(this.state.editing){
                    return this.renderForm();
                }
                else{
                    return this.renderNormal();   
                }
            }
        });
    var ExtLinkQuestion = React.createClass({
            
            getInitialState: function () {
                
                return {questionTypes:questionTypes, editing:this.props.editing | this.props.is_new, isLoaded: false, projects:this.props.projects, project_index:0, selected_metas:this.props.selected_metas, metas:[], project_id: this.props.link_project_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let project_index=this.state.projects.indexOf(this.state.projects.find(temp=>temp.id == this.state.project_id));
                if (project_index < 0){ project_index = 0; }
                this.setState({project_index:project_index, projects:this.props.projects, metas:this.props.projects[project_index].site_meta_attributes,  isLoaded: true});
               
              },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let project_index=nextProps.projects.indexOf(nextProps.projects.find(temp=>temp.id == nextProps.link_project_id));
                if (project_index < 0){ project_index = 0; }
                this.setState({project_index:project_index, projects:nextProps.projects, selected_metas:nextProps.selected_metas, metas:nextProps.projects[project_index].site_meta_attributes,  isLoaded: true});
            },
            save: function () {
                this.props.updateQuestionText(this.refs.newText.value, this.refs.questionType.value, "", this.refs.helpText.value, this.props.index);
                // console.log('save');
            },
            
            updateSelectedMetas: function(project_id, obj){
                this.props.updateLinkMetas(project_id, this.props.index, obj);
            },
            projectChanged: function () {
                const selectedProject = this.state.projects[this.refs.selectProjectRef.value]
                if (this.props.selectedProjectLinkIds.indexOf(selectedProject.id) > -1){
                    alert("Project already selected");
                    //this.setState({project_index:0});
                    // console.log(this.props.selectedProjectLinkIds, this.state.project_index);
                }else{
                    this.props.updateLinkProject(selectedProject.id, this.props.index);
                    
                    //console.log(selectedProject.site_meta_attributes);
                    this.setState({project_index:this.refs.selectProjectRef.value, project_id:selectedProject.id, metas:selectedProject.site_meta_attributes});
                    //console.log(selectedProject.id);
                    //CLEAR ALL SELECTED METAS ON CHANGE
                }
            },
            remove:function(){
                // console.log('Delete pressed.')
                this.props.deleteFromForm(this.props.index);
            },
            edit: function () {
                this.props.edit(this.props.index)
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                    
                }
                this.props.editDone(this.props.index)
            },
            renderNormal:function(){
                if(this.state.isLoaded){
                    return(
                    <tr>
                        <td>{this.props.index + 1}</td>
                        <td>{this.props.question}</td>
                        <td>{this.props.question_type}</td>
                        <td>{ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}</td>
                        <td>{ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""}</td>
                        <td></td>
                        <td></td>
                        
                        <td>
                            <a href="#" className="td-edit-btn" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"> <i className="la la-edit"> </i> </a>
                            <a href="#" className="td-delete-btn" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"> <i className="la la-trash-o"></i> </a>
                        </td>
                    </tr>  
                       
                   ); 
                }else{
                     return(
                        <div className="form-field-item margin-top"> 
                            <div className="form-field-item">
                                <div className="form-group">
                                    <label for="input11" className="col-form-label">Loading ... </label>
                                    
                                </div>
                            
                            </div>
                        </div>
                        );
                }
            },
            renderForm:function(){
                if(this.state.isLoaded){
                    return(
                    <div className="form-field-item margin-top">
                        <div className="form-group">
                            <label for="input1" className="col-form-label">Input Label:</label>
                            <input type="text" ref="newText" className="form-control" onChange={this.save} placeholder="Attribute Label" defaultValue={this.props.question}></input>
                        </div>
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionType = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Help Text:</label>
                            <textarea ref="helpText" className="form-control" value={ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""} onChange={this.save}/>
                            <small id="input1Help" className="form-text text-muted">Description for this field</small>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select Project</label>                     
                            <SelectComponent inputRef={el => this.refs.selectProjectRef = el} isProject={true} onChangeFunction={this.projectChanged} defaultValue={this.state.project_index} options={this.props.projects} />
                        </div>
                        <CheckboxComponent project_id={this.state.project_id}  selected_metas={this.state.selected_metas} metas={this.state.metas} updateSelectedMetas={this.updateSelectedMetas}/>
                        <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button>  
                    </div>
                   ); 
                }else{
                     return(
                        <div className="form-field-item">
                            <div className="form-group">
                                <label for="input11" className="col-form-label">Loading ... </label>
                                
                            </div>
                        
                        </div>);
                }
            },
            render: function () {
                if(this.state.editing){
                        return this.renderForm();
                    }
                    else{
                        return this.renderNormal();   
                }
            }
        });
var FormSubStatQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:questionTypes, editing:this.props.editing | this.props.is_new, isLoaded: false, forms:this.props.forms, form_index:0, form_id: this.props.link_form_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let form_index=this.state.forms.indexOf(this.state.forms.find(temp=>temp.id == this.state.form_id));
                if (form_index < 0){ form_index = 0; }
                this.setState({form_index:form_index, forms:this.props.forms, isLoaded: true});
            },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let form_index=nextProps.forms.indexOf(nextProps.forms.find(temp=>temp.id == nextProps.link_form_id));
                if (form_index < 0){ form_index = 0; }
                this.setState({form_index:form_index, forms:nextProps.forms, selected_question:nextProps.selected_question,  isLoaded: true});
            },
            save: function () {
                this.props.updateQuestionText(this.refs.newText.value, this.refs.questionType.value, "","", this.props.index);
            },
            
            formChanged: function () {
                const selectedForm = this.state.forms[this.refs.selectFormRef.value]    
                this.props.updateForm(selectedForm.id, this.props.index);
                this.setState({form_index:this.refs.selectFormRef.value, form_id:selectedForm.id}); 
            },
            remove:function(){
                this.props.deleteFromForm(this.props.index);
            },
            edit: function () {
                this.props.edit(this.props.index)
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                }
                this.props.editDone(this.props.index)
            },
            renderNormal:function(){
                if(this.state.isLoaded){
                    return(
                    
                    <tr>
                        <td>{this.props.index + 1}</td>
                        <td>{this.props.question}</td>
                        <td>{this.props.question_type}</td>
                        <td>{ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}</td>
                        <td>{ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""}</td>
                        <td>{this.props.forms[this.state.form_index]['name']}</td>
                        <td></td>
                        
                        <td>
                            <a href="#" className="td-edit-btn" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"> <i className="la la-edit"> </i> </a>
                            <a href="#" className="td-delete-btn" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"> <i className="la la-trash-o"></i> </a>
                        </td>
                    </tr>  
                   
                   ); 
                }else{
                     return(
                        <div className="form-field-item margin-top"> 
                            <div className="form-field-item">
                                <div className="form-group">
                                    <label for="input11" className="col-form-label">Loading ... </label>
                                    
                                </div>
                            
                            </div>
                        </div>);
                }
            },    
            renderForm:function(){
                if(this.state.isLoaded){
                    return(
                    <div className="form-field-item margin-top">
                        <div className="form-group">
                            <label for="input1" className="col-form-label">Input Label:</label>
                            <input type="text" ref="newText" className="form-control" onChange={this.save} placeholder="Attribute Label" defaultValue={this.props.question}></input>
                        </div>
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionType = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Form</label>                     
                            <SelectComponent inputRef={el => this.refs.selectFormRef = el} isProject={true} onChangeFunction={this.formChanged} defaultValue={this.state.form_index} options={this.props.forms} />
                        </div>    
                        <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button>  
                    </div>
                   ); 
                }else{
                     return(
                        <div className="form-field-item">
                            <div className="form-group">
                                <label for="input11" className="col-form-label">Loading ... </label>     
                            </div>
                        </div>);
                }   
            },
            render: function () {
                if(this.state.editing){
                        return this.renderForm();
                    }
                    else{
                        return this.renderNormal();   
                }
            }
        });
    var FormSubCountQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:questionTypes, editing:this.props.editing | this.props.is_new, isLoaded: false, forms:this.props.forms, form_index:0, form_id: this.props.link_form_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let form_index=this.state.forms.indexOf(this.state.forms.find(temp=>temp.id == this.state.form_id));
                if (form_index < 0){ form_index = 0; }
                this.setState({form_index:form_index, forms:this.props.forms, isLoaded: true});
            },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let form_index=nextProps.forms.indexOf(nextProps.forms.find(temp=>temp.id == nextProps.link_form_id));
                if (form_index < 0){ form_index = 0; }
                this.setState({form_index:form_index, forms:nextProps.forms, selected_question:nextProps.selected_question,  isLoaded: true});
            },
            save: function () {
                this.props.updateQuestionText(this.refs.newText.value, this.refs.questionType.value, "","", this.props.index);
            },
            
            formChanged: function () {
                const selectedForm = this.state.forms[this.refs.selectFormRef.value]    
                this.props.updateForm(selectedForm.id, this.props.index);
                this.setState({form_index:this.refs.selectFormRef.value, form_id:selectedForm.id}); 
            },
            remove:function(){
                this.props.deleteFromForm(this.props.index);
            },
            edit: function () {
                this.props.edit(this.props.index)            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);    
                }
                this.props.editDone(this.props.index)
            },
            renderNormal:function(){
                if(this.state.isLoaded){
                    return(
                    
                    <tr>
                        <td>{this.props.index + 1}</td>
                        <td>{this.props.question}</td>
                        <td>{this.props.question_type}</td>
                        <td>{ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}</td>
                        <td>{ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""}</td>
                        <td>{this.props.forms[this.state.form_index]['name']}</td>
                        <td></td>
                        
                        <td>
                            <a href="#" className="td-edit-btn" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"> <i className="la la-edit"> </i> </a>
                            <a href="#" className="td-delete-btn" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"> <i className="la la-trash-o"></i> </a>
                        </td>
                    </tr>
                   
                   ); 
                }else{
                     return(
                        <div className="form-field-item margin-top"> 
                            <div className="form-field-item">
                                <div className="form-group">
                                    <label for="input11" className="col-form-label">Loading ... </label>
                                    
                                </div>
                            
                            </div>
                        </div>);
                }
            },    
            renderForm:function(){
                if(this.state.isLoaded){
                    return(
                    <div className="form-field-item margin-top">
                        <div className="form-group">
                            <label for="input1" className="col-form-label">Input Label:</label>
                            <input type="text" ref="newText" className="form-control" onChange={this.save} placeholder="Attribute Label" defaultValue={this.props.question}></input>
                        </div>
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionType = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Form</label>                     
                            <SelectComponent inputRef={el => this.refs.selectFormRef = el} isProject={true} onChangeFunction={this.formChanged} defaultValue={this.state.form_index} options={this.props.forms} />
                        </div>    
                        <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button>  
                    </div>
                   ); 
                }else{
                     return(
                        <div className="form-field-item">
                            <div className="form-group">
                                <label for="input11" className="col-form-label">Loading ... </label>     
                            </div>
                        </div>);
                }   
            },
            render: function () {
                if(this.state.editing){
                        return this.renderForm();
                    }
                    else{
                        return this.renderNormal();   
                }
            }
        });
    var FormQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:questionTypes, editing:this.props.editing | this.props.is_new, isLoaded: false, forms:this.props.forms, form_index:0, selected_question:this.props.selected_question, questions:[], processed_questions:{}, form_id: this.props.link_form_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let form_index=this.state.forms.indexOf(this.state.forms.find(temp=>temp.id == this.state.form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(this.props.forms[form_index].json['children']);
                }
                console.log('did mount');
                this.setState({form_index:form_index, forms:this.props.forms,  processed_questions: questions, isLoaded: true});
                
            },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let form_index=nextProps.forms.indexOf(nextProps.forms.find(temp=>temp.id == nextProps.link_form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(nextProps.forms[form_index].json['children']);
                }
                console.log('receave` mount');
                this.setState({form_index:form_index, forms:nextProps.forms, processed_questions: questions, selected_question:nextProps.selected_question,  isLoaded: true});
            },
            save: function () {
                this.props.updateQuestionText(this.refs.newText.value, this.refs.questionType.value, "","", this.props.index);
                // console.log('save');
            },
            
            questionChanged: function(){
                let question_name = this.refs.formselectQuestionRef.value;
                let selected_question = this.state.processed_questions[question_name]
                console.log(selected_question);
                this.props.updateSQuestion(selected_question, this.props.index);
            },
            // updateSelectedQuestion: function(form_id, obj){
            //     this.props.updateFormQuestion(form_id, this.props.index, obj);
            // },
            formChanged: function () {
                // let questions = parse_form_response(this.props.forms[this.state.form_index].json['children']);
                // this.setState({processed_questions:questions})
                console.log(this.refs.selectFormRef.value);
                console.log(this.state.forms);
                const selectedForm = this.state.forms[this.refs.selectFormRef.value]
                
                this.props.updateForm(selectedForm.id, this.props.index);
                    
                    //console.log(selectedProject.site_meta_attributes);
                this.setState({form_index:this.refs.selectFormRef.value, form_id:selectedForm.id});
                    //console.log(selectedProject.id);
                    //CLEAR ALL SELECTED METAS ON CHANGE
                
            },
            remove:function(){
                // console.log('Delete pressed.')
                this.props.deleteFromForm(this.props.index);
            },
            edit: function () {
                this.props.edit(this.props.index)
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                }
                this.props.editDone(this.props.index)
                // console.log('save');
            },
            renderNormal:function(){
                console.log(this.props.question_obj, "objj")
                if(this.state.isLoaded){
                    return(
                     
                    <tr>
                        <td>{this.props.index + 1}</td>
                        <td>{this.props.question}</td>
                        <td>{this.props.question_type}</td>
                        <td>{ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}</td>
                        <td>{ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""}</td>
                        <td>{this.props.forms[this.state.form_index]['name']}</td>
                        <td>{this.props.question_obj['question']['label']}</td>
                        
                        <td>
                            <a href="#" className="td-edit-btn" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"> <i className="la la-edit"> </i> </a>
                            <a href="#" className="td-delete-btn" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"> <i className="la la-trash-o"></i> </a>
                        </td>
                    </tr>
                    
                   ); 
                }else{
                     return(
                        <div className="form-field-item margin-top">
                            <div className="form-field-item">
                                <div className="form-group">
                                    <label for="input11" className="col-form-label">Loading ... </label>    
                                </div>
                            </div>
                        </div>
                        );
                }
            },    
            renderForm:function(){
                // console.log(questions);
                if(this.state.isLoaded){
                    return(
                    <div className="form-field-item margin-top">
                        <div className="form-group">
                            <label for="input1" className="col-form-label">Input Label:</label>
                            <input type="text" ref="newText" className="form-control" onChange={this.save} placeholder="Attribute Label" defaultValue={this.props.question}></input>
                        </div>
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionType = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Form</label>                     
                            <SelectComponent inputRef={el => this.refs.selectFormRef = el} isProject={true} onChangeFunction={this.formChanged} defaultValue={this.state.form_index} options={this.props.forms} />
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Question</label>                     
                            <FormSelectComponent inputRef={el => this.refs.formselectQuestionRef = el} onChangeFunction={this.questionChanged} defaultValue={this.state.selected_question} questions={this.state.processed_questions} />
                        </div>
                        <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button>  
                    </div>
                   ); 
                }else{
                     return(
                        <div className="form-field-item margin-top"> 
                            <div className="form-field-item">
                                <div className="form-group">
                                    <label for="input11" className="col-form-label">Loading ... </label>
                                    
                                </div>
                            
                            </div>
                        </div>
                        );
                }
                
                
            },
            render: function () {
                if(this.state.editing){
                        return this.renderForm();
                    }
                    else{
                        return this.renderNormal();   
                }
            }
        });
        var FormQuestionAnswerStatus = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:questionTypes, editing:this.props.editing | this.props.is_new, isLoaded: false, forms:this.props.forms, form_index:0, selected_question:this.props.selected_question, questions:[], processed_questions:{}, form_id: this.props.link_form_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let form_index=this.state.forms.indexOf(this.state.forms.find(temp=>temp.id == this.state.form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(this.props.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, forms:this.props.forms,  processed_questions: questions, isLoaded: true});
                
            },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let form_index=nextProps.forms.indexOf(nextProps.forms.find(temp=>temp.id == nextProps.link_form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(nextProps.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, forms:nextProps.forms, processed_questions: questions, selected_question:nextProps.selected_question,  isLoaded: true});
            },
            save: function () {
                this.props.updateQuestionText(this.refs.newText.value, this.refs.questionType.value, "","", this.props.index);
                // console.log('save');
            },
            
            questionChanged: function(){
                let question_name = this.refs.formselectQuestionRef.value;
                let selected_question = this.state.processed_questions[question_name]
                console.log(selected_question);
                this.props.updateSQuestion(selected_question, this.props.index);
            },
            // updateSelectedQuestion: function(form_id, obj){
            //     this.props.updateFormQuestion(form_id, this.props.index, obj);
            // },
            formChanged: function () {
                // let questions = parse_form_response(this.props.forms[this.state.form_index].json['children']);
                // this.setState({processed_questions:questions})
                console.log(this.refs.selectFormRef.value);
                console.log(this.state.forms);
                const selectedForm = this.state.forms[this.refs.selectFormRef.value]
                
                this.props.updateForm(selectedForm.id, this.props.index);
                    
                    //console.log(selectedProject.site_meta_attributes);
                this.setState({form_index:this.refs.selectFormRef.value, form_id:selectedForm.id});
                    //console.log(selectedProject.id);
                    //CLEAR ALL SELECTED METAS ON CHANGE
                
            },
            remove:function(){
                // console.log('Delete pressed.')
                this.props.deleteFromForm(this.props.index);
            },
            edit:function(){
                this.props.edit(this.props.index);
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                }
                this.props.editDone(this.props.index)
            },
            renderNormal:function(){
                if(this.state.isLoaded){
                    return(
                     
                           <tr>
                        <td>{this.props.index + 1}</td>
                        <td>{this.props.question}</td>
                        <td>{this.props.question_type}</td>
                        <td>{ 'question_placeholder' in this.props.question_obj ? this.props.question_obj.question_placeholder:""}</td>
                        <td>{ 'question_help' in this.props.question_obj ? this.props.question_obj.question_help:""}</td>
                        <td>{this.props.forms[this.state.form_index]['name']}</td>
                        <td>{this.props.question_obj['question']['label']}</td>
                        
                        <td>
                            <a href="#" className="td-edit-btn" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"> <i className="la la-edit"> </i> </a>
                            <a href="#" className="td-delete-btn" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"> <i className="la la-trash-o"></i> </a>
                        </td>
                    </tr>
                    
                   ); 
                }else{
                     return(
                        <div className="form-field-item margin-top">
                            <div className="form-field-item">
                                <div className="form-group">
                                    <label for="input11" className="col-form-label">Loading ... </label>    
                                </div>
                            </div>
                        </div>
                        );
                }
            },    
            renderForm:function(){
                // console.log(questions);
                if(this.state.isLoaded){
                    return(
                    <div className="form-field-item margin-top">
                        <div className="form-group">
                            <label for="input1" className="col-form-label">Input Label:</label>
                            <input type="text" ref="newText" className="form-control" onChange={this.save} placeholder="Attribute Label" defaultValue={this.props.question}></input>
                        </div>
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionType = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Form</label>                     
                            <SelectComponent inputRef={el => this.refs.selectFormRef = el} isProject={true} onChangeFunction={this.formChanged} defaultValue={this.state.form_index} options={this.props.forms} />
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Question</label>                     
                            <FormSelectComponent inputRef={el => this.refs.formselectQuestionRef = el} onChangeFunction={this.questionChanged} defaultValue={this.state.selected_question} questions={this.state.processed_questions} />
                        </div>
                        <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button>  
                    </div>
                   ); 
                }else{
                     return(
                        <div className="form-field-item margin-top"> 
                            <div className="form-field-item">
                                <div className="form-group">
                                    <label for="input11" className="col-form-label">Loading ... </label>
                                    
                                </div>
                            
                            </div>
                        </div>
                        );
                }
                
                
            },
            render: function () {
                if(this.state.editing){
                        return this.renderForm();
                    }
                    else{
                        return this.renderNormal();   
                }
            }
        });
    var SitePictureFormQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:sitePictureTypes, editing:false | this.props.is_new, isLoaded: false, forms:this.props.forms, form_index:0, selected_question:this.props.selected_question, questions:[], processed_questions:{}, form_id: this.props.link_form_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let form_index=this.state.forms.indexOf(this.state.forms.find(temp=>temp.id == this.state.form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(this.props.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, forms:this.props.forms,  processed_questions: questions, isLoaded: true});
                
            },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let form_index=nextProps.forms.indexOf(nextProps.forms.find(temp=>temp.id == nextProps.link_form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(nextProps.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, forms:nextProps.forms, processed_questions: questions, selected_question:nextProps.selected_question,  isLoaded: true});
            },
            save: function () {
                console.log(this.refs, "/////////")
                this.props.updateQuestionType(this.refs.questionTypeSitePicture.value);
            },
            
            sitePicturequestionChanged: function(){
                let question_name = this.refs.formselectQuestionRefSitePicture.value;
                let selected_question = this.state.processed_questions[question_name]
                this.props.updateSitePictureSQuestion(selected_question);
            },
            sitePictureformChanged: function () {
                const selectedForm = this.state.forms[this.refs.selectFormRefSitePicture.value]
                console.log(selectedForm, ":::::::")
                this.props.updateSitePictureForm(selectedForm.id);
                this.setState({form_index:this.refs.selectFormRefSitePicture.value});
                
            },
   
            renderForm:function(){
                // console.log(questions);
               
                    return(
                    <form>
                        
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionTypeSitePicture = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Form</label>                     
                            <SelectComponent inputRef={el => this.refs.selectFormRefSitePicture = el} isProject={true} onChangeFunction={this.sitePictureformChanged} defaultValue={this.state.form_index} options={this.props.forms} />
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Question</label>                     
                            <FormSelectComponent inputRef={el => this.refs.formselectQuestionRefSitePicture = el} onChangeFunction={this.sitePicturequestionChanged} defaultValue={this.state.selected_question} questions={this.state.processed_questions} />
                        </div>
                    </form>
                   ); 
                
                
                
            },
            render: function () {
                return this.renderForm();
                    
            }
        });
    var SitePictureNormalQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:sitePictureTypes, editing:false | this.props.is_new}
            },
            save: function () {
                this.props.updateQuestionType(this.refs.questionTypeSitePicture.value);
            },
            renderForm:function(){
                return(
                            <div className="form-group">
                                <label className="col-form-label">Input Type:</label>
                                    <SelectComponent inputRef={el => this.refs.questionTypeSitePicture = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                            </div>
                    
                );
            },
            render: function () {
                        return this.renderForm();
            }
        });
    var LocationFormQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:siteLocationTypes, editing:false | this.props.is_new, isLoaded: false, forms:this.props.forms, form_index:0, selected_question:this.props.selected_question, questions:[], processed_questions:{}, form_id: this.props.link_form_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let form_index=this.state.forms.indexOf(this.state.forms.find(temp=>temp.id == this.state.form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(this.props.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, forms:this.props.forms,  processed_questions: questions, isLoaded: true});
                
            },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let form_index=nextProps.forms.indexOf(nextProps.forms.find(temp=>temp.id == nextProps.link_form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(nextProps.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, forms:nextProps.forms, processed_questions: questions, selected_question:nextProps.selected_question,  isLoaded: true});
            },
            save: function () {
                this.props.updateQuestionType(this.refs.questionTypeLocation.value);
            },
            
            questionChangedLocation: function(){
                let question_name = this.refs.formselectQuestionRefLocation.value;
                let selected_question = this.state.processed_questions[question_name]
                this.props.updateSQuestionLocation(selected_question);
            },
            formChangedLocation: function () {
                const selectedForm = this.state.forms[this.refs.selectFormRefLocation.value]
                
                this.props.updateFormLocation(selectedForm.id);
                this.setState({form_index:this.refs.selectFormRefLocation.value});
                
            },
   
            renderForm:function(){
                // console.log(questions);
               
                    return(
                    <form>
                        
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionTypeLocation = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Form</label>                     
                            <SelectComponent inputRef={el => this.refs.selectFormRefLocation = el} isProject={true} onChangeFunction={this.formChangedLocation} defaultValue={this.state.form_index} options={this.props.forms} />
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Question</label>                     
                            <FormSelectComponent inputRef={el => this.refs.formselectQuestionRefLocation = el} onChangeFunction={this.questionChangedLocation} defaultValue={this.state.selected_question} questions={this.state.processed_questions} />
                        </div>
                    </form>
                   ); 
                
                
                
            },
            render: function () {
                return this.renderForm();
                    
            }
        });
    var LocationNormalQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:siteLocationTypes, editing:false | this.props.is_new}
            },
            save: function () {
                this.props.updateQuestionType(this.refs.questionTypeLocation.value);
            },
            renderForm:function(){
                return(
                            <div className="form-group">
                                <label className="col-form-label">Input Type:</label>
                                    <SelectComponent inputRef={el => this.refs.questionTypeLocation = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                            </div>
                    
                );
            },
            render: function () {
                        return this.renderForm();
            }
        });
    var FeaturedFormQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:siteFeaturedTypes, editing:this.props.editing | this.props.is_new, isLoaded: false, forms:this.props.forms, form_index:0, selected_question:this.props.selected_question, questions:[], processed_questions:{}, form_id: this.props.link_form_id}
            },
            componentDidMount() {
                this.setState({isLoaded: false});
                let form_index=this.state.forms.indexOf(this.state.forms.find(temp=>temp.id == this.state.form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(this.props.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, editing:this.props.editing | this.props.is_new,forms:this.props.forms,  processed_questions: questions, isLoaded: true});
                
            },
            componentWillReceiveProps(nextProps) {
                this.setState({isLoaded: false});
                let form_index=nextProps.forms.indexOf(nextProps.forms.find(temp=>temp.id == nextProps.link_form_id));
                var questions = {};
                if (form_index < 0){ 
                    form_index = 0; 
                }
                else{
                    questions = parse_form_response(nextProps.forms[form_index].json['children']);
                }
                this.setState({form_index:form_index, editing:this.props.editing | this.props.is_new, forms:nextProps.forms, processed_questions: questions, selected_question:nextProps.selected_question,  isLoaded: true});
            },
            save: function () {
                this.props.updateQuestionType(this.props.index, this.refs.newTextFeatured.value, this.refs.questionTypeFeatured.value);
            },
            
            questionChangedFeatured: function(){
                let question_name = this.refs.formselectQuestionRefFeatured.value;
                let selected_question = this.state.processed_questions[question_name]
                this.props.updateSQuestionFeatured(this.props.index, selected_question);
            },
            formChangedFeatured: function () {
                const selectedForm = this.state.forms[this.refs.selectFormRefFeatured.value]
                
                this.props.updateFormFeatured(this.props.index, selectedForm.id);
                this.setState({form_index:this.refs.selectFormRefFeatured.value});
                
            },
            remove:function(){
                this.props.deleteFromForm(this.props.index);
            },
            edit:function(){
                this.props.edit(this.props.index);
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                }
                this.props.editDone(this.props.index)
            },
            renderForm:function(){
                // console.log(questions);
               
                    return(
                    <div className="form-field-item margin-top">
                        <div className="form-group">
                            <label for="input1" className="col-form-label">Input Label:</label>
                            <input type="text" ref="newTextFeatured" className="form-control" onChange={this.save} placeholder="Image Caption" defaultValue={this.props.question}></input>
                        </div>
                        <div className="form-group">
                            <label for="input2" className="col-form-label">Input Type:</label>
                            <SelectComponent inputRef={el => this.refs.questionTypeFeatured = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Form</label>                     
                            <SelectComponent inputRef={el => this.refs.selectFormRefFeatured = el} isProject={true} onChangeFunction={this.formChangedFeatured} defaultValue={this.state.form_index} options={this.props.forms} />
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Select a Question</label>                     
                            <FormSelectComponent inputRef={el => this.refs.formselectQuestionRefFeatured = el} onChangeFunction={this.questionChangedFeatured} defaultValue={this.state.selected_question} questions={this.state.processed_questions} />
                        </div>
                        <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button> 
                    </div>
                   ); 
                
                
                
            },
            renderNormal:function(){
                return(
                    <div className="col-lg-4 col-md-6">
                        <div className="card">
                            <div className="card-header sub-card-header">
                                <h5>{this.props.question}</h5>
                                <div className="add-btn">
                                    <a href="#" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"><i className="la la-edit"></i></a>
                                    <a href="#" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"><i className="la la-trash-o"></i></a>
                                </div> 
                            </div>
                            <div className="card-body">
                                <div className="before-content">
                                    <ul>
                                        <li><label>Type :</label> <span>From Form Response.</span></li>
                                        <li><label>Form :</label> <span>{this.props.forms[this.state.form_index]['name']}</span></li>
                                        <li><label>Question :</label> <span>{this.props.question_obj['question']['label']}</span></li>
                                    </ul>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                );
            },
            render: function () {
                if(this.state.editing){
                        return this.renderForm();
                    }
                    else{
                        return this.renderNormal();   
                }    
            }
        });
    var FeaturedNormalQuestion = React.createClass({
            
            getInitialState: function () {
                return {questionTypes:siteFeaturedTypes, editing:this.props.editing | this.props.is_new,}
            },
            save: function () {
                this.props.updateQuestionType(this.props.index, this.refs.newTextFeatured.value, this.refs.questionTypeFeatured.value);
            },
            remove:function(){
                this.props.deleteFromForm(this.props.index);
            },
            edit:function(){
                this.props.edit(this.props.index);
            },
            editDone: function () {
                if (this.props.is_new){
                    this.props.addtoForm(this.props.index);
                }
                this.props.editDone(this.props.index)
            },
            renderForm:function(){
                return(
                    <div className="form-field-item margin-top">
                        <div className="form-group">
                                <label for="input1" className="col-form-label">Input Label:</label>
                                <input type="text" ref="newTextFeatured" className="form-control" onChange={this.save} placeholder="Image Caption" defaultValue={this.props.question}></input>
                        </div>
                        <div className="form-group">
                            <label className="col-form-label">Input Type:</label>
                                <SelectComponent inputRef={el => this.refs.questionTypeFeatured = el} onChangeFunction={this.save} defaultValue={this.props.question_type} options={this.state.questionTypes}/>
                        </div>
                        <button className="btn btn-primary" onClick={this.editDone}><i className={this.props.is_new ? 'la la-plus':'la la-check'}></i> { this.props.is_new ? 'Add to Form':'Preview'}</button> 
                    </div>
                );
            },
            renderNormal:function(){
                return(
                    <div className="col-lg-4 col-md-6">
                        <div className="card">
                            <div className="card-header sub-card-header">
                                <h5>{this.props.question}</h5>
                                <div className="add-btn">
                                    <a href="#" data-toggle="tooltip" data-placement="top" onClick={this.edit} title="Edit"><i className="la la-edit"></i></a>
                                    <a href="#" data-toggle="tooltip" data-placement="top" onClick={this.remove} title="Delete"><i className="la la-trash-o"></i></a>
                                </div> 
                            </div>
                            <div className="card-body">
                                <div className="before-content">
                                    <ul>
                                        <li><label>Type :</label> <span>Select from Gallery.</span></li>
                                    </ul>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                );
            },
            render: function () {
                if(this.state.editing){
                    return this.renderForm();
                }
                else{
                    return this.renderNormal();   
                }
            }
        });
        var dragPlaceholder = document.createElement("li");
        dragPlaceholder.className = "dragPlaceholder ui-sortable-handle margin-top";
        dragPlaceholder.style.height = "100px";
        dragPlaceholder.style.background= "rgb(255,240,120)";

        var Form = React.createClass({
        getInitialState: function () {
            
            //console.log(linkTypeObjs);
            return {
                Questions: _json_question.concat([{
                    "question_text": "",
                    "question_type": "Text",
                    "question_name": "",
                    "question_placeholder": "",
                    "question_help": "",
                    "is_new": true,
                }]),
                projects: [{id:0, name:"Select project", site_meta_attributes:[]}],
                selectedProjectLinkIds:[],
                isLoaded: false,
                forms: [{id:0, name:"Select form", json:{ children: []}}],
                editing: null,
                site_picture: site_basic_info.hasOwnProperty('site_picture') ? site_basic_info.site_picture : {'question_type':'upload', 'form_id':0, 'question':{}},
                site_location: site_basic_info.hasOwnProperty('site_location') ? site_basic_info.site_location : {'question_type':'choose', 'form_id':0, 'question':{}},
                featured_editing: -1,
                primary_editing: -1,
                FeaturedImgs: site_featured_images.concat([{
                    "question_text": "",
                    "question_type": "choose",
                    "question_name": "",
                    "form_id": 0,
                    "question": {},
                    "is_new": true,
                }])
            }
        },
        componentDidMount() {
            
            const linkTypeObjs =_json_question.filter(function (obj) {
                    return obj.question_type == "Link" ;
                }).map(x => x.project_id);
            fetch("/fieldsight/api/organization/"+org_id+"/my_projects/"+project_id+"/", {
                  method: 'GET',
                //   credentials: 'include'
                })
              .then(res => res.json())
              .then(
                (result) => {
                    const project_options = this.state.projects.concat(result);
                    this.setState({
                        projects: project_options,
                        selectedProjectLinkIds: linkTypeObjs,
                        isLoaded: true,
                    });
                },
                (error) => {
                  this.setState({
                    isLoaded: true,
                  });
                }
              )
              fetch("https://fieldsight.naxa.com.np/fieldsight/api/project/forms/137/", {
                  method: 'GET',
                //   credentials: 'include'
                })
              .then(res => res.json())
              .then(
                (result) => {
                    const form_options = this.state.forms.concat(result);
                    this.setState({
                        forms: form_options,
                        isLoaded: true,
                    });
                },
                (error) => {
                    this.setState({
                        isLoaded: true,
                    });
                }
              )
          },
    // var question = {
    //         "question_text": "",
    //         "question_type": "Text",
    //         "question_name": ""
    //     },
    // addQuestion: function (text) {
    //     var arr =this.state.Questions;
    //     var question = {
    //         "question_text": "",
    //         "question_type": "Text",
    //         "question_name": this.state.Questions.toString()
    //     }
    //     arr.push(question);
    //     this.setState({Questions: arr});
    // },
    dragStart: function(e) {
    this.dragged = e.currentTarget;
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/html', this.dragged);
    },
    dragEnd: function(e) {
        this.dragged.style.display = 'block';
        this.dragged.parentNode.removeChild(dragPlaceholder);
    // update state
        var questions = this.state.Questions;
        var from = Number(this.dragged.dataset.id);
        var to = Number(this.over.dataset.id);
        if(from < to) to--;
        questions.splice(to, 0, questions.splice(from, 1)[0]);
        this.setState({Questions: questions});
    },
    
    dragOver: function(e) {
        e.preventDefault();
        // this.dragged.clientHeight > 0 ? dragPlaceholder.style.height = this.dragged.clientHeight  
        this.dragged.style.display = "none";
        console.log(e.target.closest("li"));
        if(e.target.className === 'elementdrag') return;
        
        if(e.target.closest("li") == null || e.target.closest("li").className != "ui-sortable-handle") return;
        this.over = e.target.closest("li");
        e.target.closest("li").parentNode.insertBefore(dragPlaceholder, e.target.closest("li"));
        
    },
    save: function () {  
        if(this.state.Questions.length < 1){ return alert("No Any Questions Found."); } 
        var is_form_valid = true;
        console.log(is_form_valid);
        var json_convertible = this.state.Questions.filter(function(item) {
           
            if (item.hasOwnProperty('is_deleted') && item.is_deleted == false){
                delete item.is_deleted;
            }
            if (!item.hasOwnProperty('is_deleted') && !item.hasOwnProperty('is_new')){
                if (item.question_text == ""){
                    console.log(item.question_text);
                    is_form_valid = false;
                    return false;
                }
                return item;
            }
        });
        
        
        if (is_form_valid === false){ return alert("The question text cannot be blank.");}
        for (var key in json_convertible) {
            json_convertible[key].question_name = json_convertible[key].question_text.replace(/\W/g,"_");
        }
        
        var active_forms = []
        var json_featured_convertible = this.state.FeaturedImgs.filter(function(item) {
            if (item.hasOwnProperty('is_deleted') && item.is_deleted == false){
                delete item.is_deleted;
            }
            if (!item.hasOwnProperty('is_deleted') && !item.hasOwnProperty('is_new')){
                return item;
            }
            if (item.question_type == 'Form'){
                active_forms.push(item.form_id)
            }
        });
        
        for (var key in json_featured_convertible) {
            json_featured_convertible[key].question_name = json_featured_convertible[key].question_text.replace(/\W/g,"_");
        }
        if (this.state.site_picture.question_text == 'Form'){
            active_forms.push(this.state.site_picture.form_id)
        }
        if (this.state.site_location.question_text == 'Form'){
            active_forms.push(this.state.site_picture.form_id)
        }
        
        site_info = {
            "active_forms": active_forms,
            "site_picture": this.state.site_picture,
            "site_location": this.state.site_location
        }
        
        var json_Question = JSON.stringify(json_convertible);
        var json_SiteFeatured = JSON.stringify(json_featured_convertible);
        var json_SiteInfo = JSON.stringify(site_info)

        console.log("json_question", json_Question);
        console.log("json_siteFeatured", json_SiteFeatured);
        console.log("json_siteInfo", json_SiteInfo)
        document.getElementById('json_questions').value = json_Question;
        document.getElementById('site_basic_info').value = json_SiteInfo;
        document.getElementById('site_featured_images').value = json_SiteFeatured;
        // document.getElementById('theForm').submit();
    },
    removeQuestion: function(i){
        var arr= this.state.Questions;
        var selectedProjectLinkIds = this.state.selectedProjectLinkIds
        arr[i].is_deleted=true;
        if (arr[i].question_type == "Link"){
            var index = selectedProjectLinkIds.indexOf(arr[i].project_id);
            if (index > -1) {
              selectedProjectLinkIds.splice(index, 1);
            }
        }
        this.setState({Questions: arr, selectedProjectLinkIds: selectedProjectLinkIds});
    },
    updateQuestion: function (newtext, questionType, placeholder, help, i) {
        var arr = this.state.Questions;
        if (arr[i].question_type == "MCQ" && questionType != "MCQ"){
            delete arr[i].mcq_options; 
        }
        else if(arr[i].question_type == "Link" && questionType != "Link"){
            delete arr[i].project_id;
            delete arr[i].metas;
        }
        else if((arr[i].question_type == "Form" && questionType != "Form") || (questionType == "FormQuestionAnswerStatus" && arr[i].question_type != "FormQuestionAnswerStatus")){
            delete arr[i].form_id;
            delete arr[i].question;
        }
        else if((arr[i].question_type == "FormSubStat" && questionType != "FormSubStat") || (arr[i].question_type == "FormSubCountQuestion" && questionType != "FormSubCountQuestion")){
            delete arr[i].form_id;
        }
        if(questionType == "MCQ" && arr[i].question_type != "MCQ"){
            arr[i].mcq_options=[];
        }
        else if(questionType == "Link" && arr[i].question_type != "Link"){
            arr[i].project_id = 0;
            arr[i].metas={};
        }
        else if((questionType == "Form" && arr[i].question_type != "Form") || (questionType == "FormQuestionAnswerStatus" && arr[i].question_type != "FormQuestionAnswerStatus")){
            arr[i].form_id = 0;
            arr[i].question={};
        }
        else if((questionType == "FormSubStat" && arr[i].question_type != "FormSubStat") || (arr[i].question_type == "FormSubCountQuestion" && questionType != "FormSubCountQuestion")){
            arr[i].form_id = 0;
        }
        arr[i].question_text=newtext;
        arr[i].question_type=questionType;
        arr[i].question_placeholder=placeholder;
        arr[i].question_help=help;
        this.setState({Questions:arr});
    },
    updateMCQOptions: function (options, i){
        var arr = this.state.Questions;
        var newOptionsArray = options.filter(function (op) {
        if (!op.hasOwnProperty('is_deleted')){
            return op
            }
        });
        arr[i].mcq_options=newOptionsArray;
        this.setState({Questions:arr});
    },
    updateLinkProject: function (project_id, i){
        var arr = this.state.Questions;
        var selectedProjectLinkIds = this.state.selectedProjectLinkIds
        var prev_project_id = arr[i].project_id
        arr[i].project_id=project_id;
        arr[i].metas = {};
        var index = selectedProjectLinkIds.indexOf(prev_project_id);
        if (index > -1) {
          selectedProjectLinkIds.splice(index, 1);
        }
        selectedProjectLinkIds.push(project_id);newTextFeatured
        
        this.setState({Questions:arr, selectedProjectLinkIds: selectedProjectLinkIds});
    },
    updateForm: function (form_id, i){
        var arr = this.state.Questions;
        arr[i].form_id=form_id;
        if (arr[i].question_type == "Form"){
            arr[i].question = {};
        }
        this.setState({Questions:arr});
    },
    updateSQuestion: function (obj, i){
        var arr = this.state.Questions;
        arr[i].question = obj;
        this.setState({Questions:arr});
    },
    updateSitePictureForm: function (form_id){
        var arr = this.state.site_picture;
        arr.form_id=form_id;
        arr.question = {};
        this.setState({site_picture:arr});
    },
    updateSitePictureSQuestion: function (obj){
        var arr = this.state.site_picture;
        arr.question = obj;
        this.setState({site_picture:arr});
    },
    updateSitePictureQuestion: function (questionType) {
        var arr = this.state.site_picture;
        console.log(questionType, "-----")
        arr.question_type=questionType;
        this.setState({site_picture:arr});
    },
    updateFormLocation: function (form_id){
        var arr = this.state.site_location;
        arr.form_id=form_id;
        arr.question = {};
        this.setState({site_location:arr});
    },
    updateSQuestionLocation: function (obj){
        var arr = this.state.site_location;
        arr.question = obj;
        this.setState({site_location:arr});
    },
    updateQuestionLocation: function (questionType) {
        var arr = this.state.site_location;
        arr.question_type=questionType;
        this.setState({site_location:arr});
    },
    updateFormFeatured: function (i, form_id){
        var arr = this.state.FeaturedImgs;
        arr[i].form_id=form_id;
        this.setState({FeaturedImgs:arr});
    },
    updateSQuestionFeatured: function (i, obj){
        var arr = this.state.FeaturedImgs;
        arr[i].question = obj;
        this.setState({FeaturedImgs:arr});
    },
    updateQuestionFeatured: function (i, question, questionType) {
        var arr = this.state.FeaturedImgs;
        arr[i].question_type=questionType;
        arr[i].question_text=question;
        this.setState({FeaturedImgs:arr});
    },
    removeFeatured: function(i){
        var arr= this.state.FeaturedImgs;
        arr[i].is_deleted=true;
        this.setState({FeaturedImgs: arr});
    },
    editFeatured: function(i){
        this.setState({featured_editing: i});
        $('#add-feature-pic').addClass('open');
    },
    editDoneFeatured: function(i){
        this.setState({featured_editing: -1});
        $('#add-feature-pic').removeClass('open');
    },
    editPrimary: function(i){
        this.setState({primary_editing: i});
        $('#site-info-popup').addClass('open');
    },
    editDonePrimary: function(i){
        this.setState({primary_editing: -1});
        $('#site-info-popup').removeClass('open');
    },
    updateIndividualLink: function (project_id, i, obj){
        var arr = this.state.Questions;
        if (project_id in arr[i].metas){
            const obj_exists = arr[i].metas[project_id].find(temp=>temp.question_name == obj.question_name)
        
            if (obj_exists){
                arr[i].metas[project_id].splice(arr[i].metas[project_id].indexOf(obj_exists), 1);
                
            }
            else{
                arr[i].metas[project_id].push(obj);
            }
        }
        else{
            arr[i].metas[project_id]=[obj];
        }
        this.setState({Questions:arr});
    },
    updateLinkMetas: function (project_id, i, obj){
        
        this.updateIndividualLink(project_id, i, obj);
        // if (obj['question_type'] === "Link"){
        //     obj.metas[obj['project_id']].forEach((item) => {this.updateIndividualLink(obj['project_id'], i, item);});
        // }
        //console.log("updatingLinkmetas");
        
        
    },
    addtoForm: function (i) {  
        var arr = this.state.Questions;
        // console.log(arr[i], arr);
        if (arr[i].hasOwnProperty('is_new')) {
            delete arr[i].is_new;
               
            arr.push({
                        "question_text": "",
                        "question_type": "Text",
                        "question_name": "",
                        "question_placeholder": "",
                        "question_help": "",
                        "is_new": true,
                    });
            // console.log(arr);
            $('.fieldsight-popup').removeClass('open');
            this.setState({Questions:arr});
        }
    },
    addtoFormFeatured: function (i) {  
        var arr = this.state.FeaturedImgs;
        if (arr[i].hasOwnProperty('is_new')) {
            delete arr[i].is_new;
            if (arr.length > 5){
                return
            }
            arr.push({
                        "question_text": "",
                        "question_type": "choose",
                        "question_name": "",
                        "form_id": 0,
                        "question": {},
                        "is_new": true,
                    });
            // console.log(arr);
            $('#add-feature-pic').removeClass('open');
            this.setState({FeaturedImgs:arr});
        }
    },
    eachQuestion: function (is_new=false, id=false, question, i, is_editing){
        
        if( (!question.hasOwnProperty('is_deleted') || (question.hasOwnProperty('is_deleted') && question.is_deleted == false)) && ( is_new  || !question.hasOwnProperty('is_new')) ){
            if(question.question_type=="MCQ" ){
                                     
                        var renderedQuestion= <MCQQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoForm} is_new={is_new} question_obj={question} options={question.mcq_options} question={question.question_text} question_type={question.question_type}  updateQuestionText={this.updateQuestion} updateMCQOptions={this.updateMCQOptions} deleteFromForm={this.removeQuestion} edit={this.editPrimary} editDone={this.editDonePrimary} editing={is_editing}/>
                        
                  
            }
            else if(question.question_type=="Link"){
               
                        var renderedQuestion= <ExtLinkQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoForm} is_new={is_new} question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionText={this.updateQuestion} updateLinkProject={this.updateLinkProject} link_project_id ={question.project_id} updateLinkMetas={this.updateLinkMetas} selected_metas={question.metas} deleteFromForm={this.removeQuestion} selectedProjectLinkIds={this.state.selectedProjectLinkIds} projects={this.state.projects} edit={this.editPrimary} editDone={this.editDonePrimary} editing={is_editing}/>                        
                        
                   
            }
            else if(question.question_type=="FormSubStat"){
                
                       
                        var renderedQuestion= <FormSubStatQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoForm} is_new={is_new} question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionText={this.updateQuestion} updateForm={this.updateForm} link_form_id ={question.form_id} deleteFromForm={this.removeQuestion} forms={this.state.forms} edit={this.editPrimary} editDone={this.editDonePrimary} editing={is_editing}/>                        
                        
                   
            }
            else if(question.question_type=="Form"){
                
                        
                        var renderedQuestion= <FormQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoForm} is_new={is_new} question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionText={this.updateQuestion} updateForm={this.updateForm} link_form_id ={question.form_id} updateSQuestion={this.updateSQuestion} selected_question={question.question.name} deleteFromForm={this.removeQuestion} forms={this.state.forms} edit={this.editPrimary} editDone={this.editDonePrimary} editing={is_editing}/>                        
                       
                  
            }
            else if(question.question_type=="FormQuestionAnswerStatus"){
                
                        
                        var renderedQuestion= <FormQuestionAnswerStatus key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoForm} is_new={is_new} question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionText={this.updateQuestion} updateForm={this.updateForm} link_form_id ={question.form_id} updateSQuestion={this.updateSQuestion} selected_question={question.question.name} deleteFromForm={this.removeQuestion} forms={this.state.forms} edit={this.editPrimary} editDone={this.editDonePrimary} editing={is_editing}/>                        
                       
                  
            }
            else if(question.question_type=="FormSubCountQuestion"){
                
                       
                        var renderedQuestion= <FormSubCountQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoForm} is_new={is_new} question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionText={this.updateQuestion} updateForm={this.updateForm} link_form_id ={question.form_id} deleteFromForm={this.removeQuestion} forms={this.state.forms} />                        
                        
                   
            }
            else{
                        var renderedQuestion= <NormalQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoForm} is_new={is_new} question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionText={this.updateQuestion} deleteFromForm={this.removeQuestion} edit={this.editPrimary} editDone={this.editDonePrimary} editing={is_editing}/>
                       
                
            }
            if(question.hasOwnProperty('is_new')){
                return (
                   
                        renderedQuestion 
                   
                    );
            }
            else{
                return (
                    
                        renderedQuestion 
                    
                );}
        }
    },
    SiteImageQuestion: function (question){
            if(question.question_type=="Form"){
                
                        
                        var renderedQuestion= <SitePictureFormQuestion question_obj={question} question={question.question_text} updateQuestionType={this.updateSitePictureQuestion} question_type={question.question_type} updateSitePictureForm={this.updateSitePictureForm} link_form_id ={question.form_id} updateSitePictureSQuestion={this.updateSitePictureSQuestion} selected_question={question.question.name} forms={this.state.forms} />                        
                       
                  
            }
            else {
                        var renderedQuestion= <SitePictureNormalQuestion question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionType={this.updateSitePictureQuestion} />
                       
                
            }
            
            return (
                
                    renderedQuestion 
                
            );
        
    },
    LocationQuestion: function (question){
            if(question.question_type=="Form"){
                
                        
                        var renderedQuestion= <LocationFormQuestion question_obj={question} question={question.question_text} updateQuestionType={this.updateQuestionLocation} question_type={question.question_type} updateFormLocation={this.updateFormLocation} link_form_id ={question.form_id} updateSQuestionLocation={this.updateSQuestionLocation} selected_question={question.question.name} forms={this.state.forms} />                        
                       
                  
            }
            else {
                        var renderedQuestion= <LocationNormalQuestion question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionType={this.updateQuestionLocation} />
                       
                
            }
            
            return (
                
                    renderedQuestion 
                
            );
        
    },
    popUpMain: function (){
        $('add-feature-pic').addClass('open');
    },
    eachFeaturedImgs: function (is_new=false, id=false, question, i, is_editing=false){
            if( (!question.hasOwnProperty('is_deleted') || (question.hasOwnProperty('is_deleted') && question.is_deleted == false)) && ( is_new  || !question.hasOwnProperty('is_new')) ){
                if(question.question_type=="Form"){
                            var renderedQuestion= <FeaturedFormQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoFormFeatured} is_new={is_new} question_obj={question} question={question.question_text} updateQuestionType={this.updateQuestionFeatured} question_type={question.question_type} updateFormFeatured={this.updateFormFeatured} link_form_id ={question.form_id} updateSQuestionFeatured={this.updateSQuestionFeatured} selected_question={question.question.name} forms={this.state.forms} deleteFromForm={this.removeFeatured} edit={this.editFeatured} editDone={this.editDoneFeatured} editing={is_editing}/>                        
                }
                else {
                            var renderedQuestion= <FeaturedNormalQuestion key={is_new?id:i} index={is_new?id:i} addtoForm={this.addtoFormFeatured} is_new={is_new} question_obj={question} question={question.question_text} question_type={question.question_type}  updateQuestionType={this.updateQuestionFeatured} deleteFromForm={this.removeFeatured } edit={this.editFeatured} editDone={this.editDoneFeatured} editing={is_editing}/>
                }
            
                return (
                    
                        renderedQuestion 
                    
                );
            }
        },
    primaryPopUp: function(){
        if (this.state.primary_editing > -1){
            var index = this.state.primary_editing
        }
        else{
            var index = this.state.Questions.length - 1   
        }
        return [this.state.Questions[index]].map(this.eachQuestion.bind(this, true, index))
    },
    featuredPopUp: function(){
        if (this.state.featured_editing > -1){
            console.log('here--fukkkkkk');
            var index = this.state.featured_editing
        }
        else{
            var index = this.state.FeaturedImgs.length - 1   
        }
        return [this.state.FeaturedImgs[index]].map(this.eachFeaturedImgs.bind(this, true, index))
    },
    render: function () {
        var listItems = this.state.Questions.map(this.eachQuestion.bind(this, false, false));
        var site_picture = this.SiteImageQuestion(this.state.site_picture);
        var site_location = this.LocationQuestion(this.state.site_location);
        var listFeaturedImgs = this.state.FeaturedImgs.map(this.eachFeaturedImgs.bind(this, false, false));
        var primaryPopUp = this.primaryPopUp();
        var featuredPopUp = this.featuredPopUp();
        return (
                <div className="card">
                    <div className="card-header main-card-header">
                        <h5>Site Identification</h5>
                    </div>
                    
                <div className="identity-form">
                    <div className="row">
                        <div className="col-lg-6">
                            <div className="site_photo_form">
                                <div className="card">
                                    <div className="card-header sub-card-header">
                                        <h5>Site information</h5>
                                    </div>
                                    <div className="card-body">
                                        
                                    {
                                        site_picture
                                    }
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div className="col-lg-6">
                            <div className="site-location">
                                <div className="card">
                                    <div className="card-header sub-card-header">
                                        <h5>Site Location</h5>
                                    </div>
                                    <div className="card-body">
                                            {
                                                site_location
                                            }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div className="card no-boxshadow">
                    <div className="card-header main-card-header">
                        <h5>Site information</h5>
                        <div className="add-btn">
                            <a href="#" data-tab="site-info-popup">Add new <span><i className="la la-plus"></i></span></a>
                        </div>
                    </div>
                    <div className="card-body">
                        <table id="siteinfo_table" className="table  table-bordered table siteinfo_table">
                            <thead>
                                <tr>
                                    <th > S.N</th>
                                    <th >Attribute</th>
                                    <th >Placeholder Text</th>
                                    <th >Help Text</th>
                                    <th >Type</th>
                                    <th >Form</th>
                                    <th >Question</th>
                                    <th >Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                        {   
                                            listItems
                                        }
                            </tbody>
                        </table>
                    </div>
                    <div className="fieldsight-popup" id="site-info-popup">
                        <div className="popup-body">
                            <div className="card">
        
                                    {
                                        this.state.primary_editing < 0 ? 
                                            <div className="card-header main-card-header">
                                                <h5>Add Site Information</h5>
                                                <span className="popup-close"><i className="la la-close"></i></span>
                                            </div>
                                            : <div className="card-header main-card-header">
                                                <h5>Edit Site Information</h5>    
                                            </div>
                                    }   
                                 
                                <div className="card-body">
                                   {   
                                        primaryPopUp
                                    }  
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div className="card no-boxshadow">
                    <div className="card-header main-card-header">
                        <h5>featured pictures</h5>
                        <div className="add-btn">
                            <a href="#" data-tab="add-feature-pic">Add new <span><i className="la la-plus"></i></span></a>
                        </div>
                    </div>
                    <div className="card-body">
                        <div className="row">
                            {
                                listFeaturedImgs
                            }
                        </div>
                    </div>
                    <div className="fieldsight-popup featured" id="add-feature-pic">
                        <div className="popup-body">
                            <div className="card">
                                
                                {
                                    this.state.featured_editing < 0 ? 
                                        <div className="card-header main-card-header">
                                            <h5>Add Featured Image</h5>
                                            <span className="popup-close"><i className="la la-close"></i></span>
                                        </div>
                                        : <div className="card-header main-card-header">
                                            <h5>Edit featured Image</h5>    
                                        </div>
                                }
                               
                                <div className="card-body">
                                    {   
                                       featuredPopUp 
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button onClick={this.save.bind()} className="btn btn-success pull-right"><i className="la la-save"></i>
                    Save Form</button>
            </div> 
            // <div>
            // <header className="panel-heading clearfix">
            //     <h3><i className="la la-cogs"></i>Site Meta Attributes</h3>
            //     <button onClick={this.save.bind()} className="btn btn-success pull-right"><i className="la la-save"></i>Save Form</button>
            // </header>
            // <div className="panel-body">
            //     <div className="row">
            //         <div className="col-md-4">
            //             <div className="">
            //                 {   
            //                     [this.state.Questions[this.state.Questions.length - 1]].map(this.eachQuestion.bind(this, true, this.state.Questions.length - 1))
            //                 }  
            //             </div>
            //         </div>
            //         <div className="col-md-8">
            //             <ul id="hero" className="hero form-field-list bg-gray margin-top ui-sortable" onDragOver={this.dragOver.bind(this)}>
            //                 {   
            //                     listItems
            //                 }
            //             </ul>
                        
            //         </div>
            //     </div>
            // </div>
            // </div>
            );
        }
    });
    ReactDOM.render(<Form /> , document.getElementById('site_info'));
</script>

</body>

</html>